Промпт для Cursor: Учебный интернет-магазин эко-товаров на Django с личным кабинетом
Контекст для разработчика (Cursor):
Создай простой, но полноценный интернет-магазин на Django для обучения. Фокус — на чистом Django (без DRF), понятной структуре и аккуратном интерфейсе на Bootstrap 5. Код должен быть хорошо документирован, с четким разделением ответственности. Локализация: Интерфейс — на русском языке. Slug — латиница.

Цели проекта:
Обучающая: Продемонстрировать работу моделей, представлений, шаблонов, форм, аутентификации и сессий.

Практическая: Создать рабочий прототип магазина, который можно наполнить данными и показать.

Эстетическая: Интерфейс должен быть минималистичным, современным и удобным.

Архитектура и структура
Приложения:

products — каталог товаров и категории.

orders — корзина, оформление заказа, история заказов.

accounts — регистрация, авторизация, личный кабинет.

Базовая логика:

Гость может просматривать каталог и добавлять товары в сессионную корзину,
но оформление заказа доступно только после авторизации.

После оформления заказ привязывается к пользователю и попадает в его историю.

Пошаговый план реализации
Этап 1: Инициализация и базовая настройка
Настрой Django-проект ecoshop. Создай приложения: products, orders, accounts.

Настрой STATIC и MEDIA в settings.py. Для разработки используй SQLite.

Подключи CDN Bootstrap 5 и Font Awesome (для иконок) в будущий базовый шаблон.

В settings.py добавь LOGIN_URL, LOGIN_REDIRECT_URL, LOGOUT_REDIRECT_URL. Настрой AUTH_USER_MODEL не переопределять, использовать стандартную модель User.

Этап 2: Модели данных (models.py)
products/models.py:

Category: name (Овощи, Фрукты...), slug, image (опционально).

Product: category (ForeignKey), name, slug, image, description, price (DecimalField), weight, calories, protein, fat, carbs (CharField, т.к. данные вида "35 ккал"), in_stock (BooleanField). Методы: get_absolute_url, formatted_price.

orders/models.py:

Order:
- user (ForeignKey to User, on_delete=models.CASCADE, null=False)
- phone
- address
- created_at (auto_now_add=True)
- status (CharField с choices: 'новый', 'подтвержден', 'выполнен')

Order.user — обязательное поле.
Заказы создаются только для авторизованных пользователей.
Гостевые заказы не поддерживаются.
Метод: total_price.

Order.user — обязательное поле.
Заказы создаются только для авторизованных пользователей.
Гостевые заказы не поддерживаются.

OrderItem: order (ForeignKey), product (ForeignKey), quantity, price_at_order (DecimalField — фиксируем цену на момент покупки).
При создании OrderItem используй цену из сессионной корзины, а не из Product.

accounts/models.py:

Profile: user (OneToOne to User), avatar (ImageField), phone, default_address. Сигнал: автоматическое создание профиля при регистрации.

Этап 3: Аутентификация и авторизация (accounts app)
Формы:

CustomUserCreationForm: Наследуй от UserCreationForm, добавь поля email, phone.
Поле phone сохраняй в связанную модель Profile (через form_valid или сигнал).

ProfileUpdateForm: Для редактирования профиля (аватар, телефон, адрес).

CustomAuthenticationForm: Можно оставить стандартный.

Представления (CBV — Class-Based Views для наглядности):

RegisterView (CreateView)

LoginView (LoginView)

LogoutView (LogoutView)

ProfileView (DetailView): Показывает профиль и историю заказов.

ProfileUpdateView (UpdateView)

Шаблоны (templates/accounts/):

register.html, login.html — стилизованные формы Bootstrap.

profile.html: Приветствие, аватар, контактные данные, история заказов (таблица с ссылками на детализацию заказа).

profile_edit.html: Форма редактирования.

Этап 4: Логика магазина (products & orders apps)
products/views.py:

ProductListView (ListView): С фильтрацией по категориям (через GET-параметр).

ProductDetailView (DetailView)

orders/views.py — ключевая логика:

Корзина (сессия):

cart_add(request, product_id): Добавляет/увеличивает количество.

cart_remove(request, product_id): Уменьшает/удаляет.

cart_detail(request): Детальный просмотр корзины с формой изменения количества.

Оформление заказа:

checkout(request):

Если пользователь не авторизован — редирект на регистрацию/вход.

Если корзина пуста — сообщение об ошибке.

POST: Создает объекты Order и OrderItem на основе сессионной корзины, привязывает к request.user, очищает корзину.

История заказов:

OrderListView (ListView): Показывает заказы только текущего пользователя (self.request.user). Защитить LoginRequiredMixin.

OrderDetailView (DetailView): Детали заказа с таблицей товаров. Проверять, что заказ принадлежит текущему пользователю.

Этап 5: Интерфейс и шаблоны
Базовый шаблон (base.html):

Навигационная панель (navbar):

Слева: Логотип, "Каталог".

Справа: Условный блок:

Для гостя: "Войти", "Регистрация", иконка корзины с количеством товаров (из контекст-процессора).

Для пользователя: "Личный кабинет (имя)", "Выход", иконка корзины.

Подключение Bootstrap 5, Font Awesome, кастомный CSS.

Вывод сообщений (messages framework).

Шаблоны:

products/list.html: Сетка карточек товаров. На карточке: изображение, название, цена, кнопка "В корзину". Фильтры по категориям — кнопки над сеткой.

products/detail.html: Детальная информация, большая кнопка "В корзину".

orders/cart.html: Таблица с товарами, форма для изменения количества, кнопка "Оформить заказ" (активна только для авторизованных).

orders/checkout.html: Простая форма с полями "телефон" и "адрес" (предзаполнить из профиля, если есть). Кнопка "Подтвердить заказ".

orders/order_*: Шаблоны для истории заказов.

Этап 6: Вспомогательные компоненты
Контекст-процессор: Создай cart_context_processor.py, который добавляет в контекст общее количество товаров в корзине и общую сумму для отображения в navbar.

Миксины: Создай LoginRequiredMixinWithMessage (наследуй от LoginRequiredMixin), который при редиректе добавляет сообщение: "Для оформления заказа войдите в систему".

Команда управления: Создай management/commands/load_products.py для импорта товаров из JSON (как в твоём примере). Преобразуй английские названия категорий из JSON в русские.

Этап 7: Финальная полировка
Админ-панель: Зарегистрируй все модели. Для Order сделай удобный интерфейс с фильтрацией по статусу и пользователю.

Тесты (опционально, но желательно): Напиши несколько простых тестов для моделей и основных представлений (например, проверка, что OrderListView возвращает только заказы текущего пользователя).

Кастомный CSS (static/css/style.css): Добавь немного стилей для улучшения внешнего вида: тень для карточек, кастомные цвета для кнопок, адаптивные отступы.

Критерии успеха готового проекта
Для гостя:

Просмотр каталога с фильтрацией.

Добавление товаров в корзину (данные сохраняются между запросами).

При попытке оформить заказ — редирект на страницу входа с поясняющим сообщением.

Для пользователя:

Полный функционал гостя.

Оформление заказа с предзаполненными контактами.

Просмотр истории заказов в личном кабинете.

Редактирование профиля (телефон, адрес, аватар).

Для администратора (через админку):

Управление товарами, категориями, заказами.

Возможность менять статус заказов.

Запуск команды импорта товаров.

Технические:

Чистая, хорошо структурированная кодовая база.

Аккуратный, отзывчивый интерфейс на Bootstrap 5.

Работающая сессионная корзина.

Корректная аутентификация и разграничение прав.

Дополнительные указания для Cursor
Приоритет читаемости кода: Пиши простые представления 
CRUD и страницы профиля — CBV.
Корзина и checkout — FBV.
Добавляй комментарии к сложной логике.

Безопасность: Используй @login_required, csrf_protect, валидацию форм.

Производительность: Для списка заказов в личном кабинете используй select_related/prefetch_related, чтобы избежать N+1 проблемы.

UI/UX: Сделай интерфейс последовательным. Используй компоненты Bootstrap: тосты для сообщений, модальные окна (если нужно), адаптивную сетку.

Обработка ошибок: Пропиши обработку случаев "товар не найден", "заказ не найден" или "заказ не принадлежит пользователю" (возвращай 404).

Результат: После выполнения всех шагов я получу готовый к работе учебный проект, который демонстрирует ключевые возможности Django в контексте реального приложения. Я смогу запустить его, создать суперпользователя, загрузить товары через команду, протестировать весь цикл от регистрации до оформления заказа, и увижу, как данные связаны между собой.